@page
@model CompanyWebpages.Pages.EmployeeDashboardModel
@using gategourmetLibrary.Models
@{
    ViewData["Title"] = "Employee Dashboard";
}

<h2 class="mb-3" style="font-family:'Playfair Display',serif;">My Tasks</h2>

@{
    // check if there are any tasks without a registered warehouse location
    bool hasUnassigned = false;
    if (Model.Tasks != null)
    {
        foreach (EmployeeTask t in Model.Tasks)
        {
            if (t.Location == "Not registered")
            {
                hasUnassigned = true;
                break;
            }
        }
    }
}

@if (hasUnassigned)
{
    <div class="alert alert-warning">
        Some tasks do not have a warehouse assigned yet.
    </div>
}

<div class="table-responsive">
    <table class="table align-middle shadow-sm text-white">
        <thead class="text-white">
            <tr>
                <th>Order</th>
                <th>Task</th>
                <th>Location</th>
                <th>Status</th>
                <th>Actions</th>
                <th>Update location</th>
            </tr>
        </thead>
        <tbody>

            @if (Model.Tasks != null && Model.Tasks.Any())
            {
                foreach (EmployeeTask task in Model.Tasks)
                {
                    <tr>
                        <td>@task.OrderId</td>
                        <td>@task.TaskName</td>

                        <td>
                            @* show colored badge based on warehouse type *@
                            @if (task.Location == "Freezer")
                            {
                                <span class="badge bg-primary">Freezer</span>
                            }
                            else if (task.Location == "Fridge")
                            {
                                <span class="badge bg-success">Fridge</span>
                            }
                            else if (task.Location == "Dry")
                            {
                                <span class="badge bg-warning text-dark">Dry</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">Not registered</span>
                            }
                        </td>

                        <td>
                            @if (task.IsCompleted)
                            {
                                <span class="badge bg-success">Done</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark">In Progress</span>
                            }
                        </td>
                        <td>
                            @if (!task.IsCompleted)
                            {
                                <form method="post" asp-page-handler="MarkDone" class="d-inline">
                                    <input type="hidden" name="orderId" value="@task.OrderId" />
                                    <input type="hidden" name="recipePartId" value="@task.RecipePartId" />
                                    <button type="submit" class="btn btn-sm btn-success">
                                        Mark done
                                    </button>
                                </form>
                            }
                            else
                            {
                                <span class="text-muted">Completed</span>
                            }
                        </td>

                        <td>
                            <a class="btn btn-sm btn-outline-info"
                               asp-page="/EmployeeTaskLocation"
                               asp-route-recipePartId="@task.RecipePartId">
                                Change location
                            </a>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="6" class="text-muted">No tasks assigned.</td>
                </tr>
            }
        </tbody>
    </table>
</div>
